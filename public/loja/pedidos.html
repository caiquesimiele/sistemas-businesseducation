 <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Pedidos | Business Education &amp; Colégio Adventista de Campos</title>
    <meta name="description" content="Acompanhe o status dos seus pedidos, veja detalhes de compras e histórico de transações.">
    <meta name="store-id" content="S4VWCB5F-CAPEC">
    <meta name="store-name" content="Colégio Adventista de Campos">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://loja.businesseducation.com.br/stores/s4vwcb5f-capec/pedidos/meus-pedidos.php">
    <meta property="og:title" content="Meus Pedidos | Business Education &amp; Colégio Adventista de Campos">
    <meta property="og:description" content="Consulte seus pedidos, acompanhe entregas e veja o histórico completo de suas compras.">
    <meta property="og:image" content="https://loja.businesseducation.com.br/stores/imagens/og_preview_pedidos.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Loja Rápida Business Education">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://loja.businesseducation.com.br/stores/s4vwcb5f-capec/pedidos/meus-pedidos.php">
    <meta name="twitter:title" content="Meus Pedidos | Business Education &amp; Colégio Adventista de Campos">
    <meta name="twitter:description" content="Consulte seus pedidos, acompanhe entregas e veja o histórico completo de suas compras.">
    <meta name="twitter:image" content="https://loja.businesseducation.com.br/stores/imagens/og_preview_pedidos.png">
    
    <link rel="icon" type="image/png" href="../Favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/pedidos.css">
    <link rel="stylesheet" href="css/rocket-background.css">

</head>
<body>
<!-- Header -->
<header class="site-header">
    <div class="header-container">
        <div class="logo-container">
            <a href="../home/" title="Ir para a página inicial">
                <img src="../images/logo-loja.png" alt="Logo Business Education">
            </a>
        </div>
        <nav class="header-nav">
        <a href="../index" class="header-btn loja-rapida-destaque" title="Loja Rápida">
            <span class="btn-text">Loja Rápida</span>
            <span class="btn-text-mobile">Loja Rápida</span>
            <i class="fas fa-store"></i>
        </a>
        <a href="#" class="header-btn carrinho" id="header-btn-carrinho" title="Carrinho">
            <span class="btn-text">Carrinho</span>
            <span class="btn-text-mobile"></span>
            <i class="fas fa-shopping-cart"></i>
        </a>
        <a href="../ajuda/index" class="header-btn ajuda" title="Ajuda">
            <span class="btn-text">Ajuda</span>
            <span class="btn-text-mobile">Ajuda</span>
            <i class="fas fa-headset"></i>
        </a>
        <a href="../faq/index" class="header-btn" title="FAQ">
            <span class="btn-text">FAQ</span>
            <span class="btn-text-mobile"></span>
            <i class="fas fa-question-circle"></i>
        </a>
        <a href="https://wa.me/551142102216" target="_blank" class="header-btn whatsapp" title="WhatsApp">
            <span class="btn-text">WhatsApp</span>
            <span class="btn-text-mobile">WhatsApp</span>
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://businesseducation.com.br" target="_blank" class="header-btn business" title="Site Business">
            <span class="btn-text">Site Business</span>
            <span class="btn-text-mobile">Business</span>
            <img src="../images/favicon-business.png" class="favicon-icon" alt="Business">
        </a>
        </nav>
    </div>
</header>

    <div class="main-container">
        <div class="auth-container">
        <div class="auth-header">
            <div class="auth-icon">
                <i class="fas fa-box"></i>
            </div>
            <h1>Meus Pedidos</h1>
            <p>Acompanhe o status dos seus pedidos</p>
        </div>
        
        <form id="cpfForm">
            <div class="form-group">
                <label for="cpf" style="color: #121F4B; font-weight: 600; margin-bottom: 10px; display: block;">
                    Informe seu CPF:
                </label>
                <input type="text" id="cpf" name="cpf" class="cpf-input" placeholder="000.000.000-00" required maxlength="14">
            </div>
            
            <button type="submit" class="btn-auth" id="btnBuscar">
                <i class="fas fa-search"></i>
                Buscar Pedidos
            </button>
        </form>
        
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
        
        <div class="info-box">
            <h3><i class="fas fa-info-circle"></i> Como funciona?</h3>
            <p>
                Digite seu CPF para encontrar seus pedidos. Você poderá escolher entre:
                <br><br>
                <div class="access-type">
                    <i class="fas fa-eye access-icon"></i>
                    <div class="access-text">
                        <strong>Acesso Simples:</strong> Visualize apenas o status dos pedidos
                    </div>
                </div>
                <div class="access-type">
                    <i class="fas fa-user-shield access-icon"></i>
                    <div class="access-text">
                        <strong>Acesso Completo:</strong> Veja todos os detalhes, baixe notas fiscais e acompanhe entregas. Confirmação de e-mail necessária.
                    </div>
                </div>
            </p>
        </div>
        
        <div class="back-link">
            <a href="../index">
                <i class="fas fa-arrow-left"></i> Voltar para a loja
            </a>
        </div>
        </div>
    </div>

    <script>
        // Formatação do CPF
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });

        // Validação do CPF
        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11) return false;
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf[i]) * (10 - i);
            }
            let resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf[9])) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf[i]) * (11 - i);
            }
            resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf[10])) return false;
            
            return true;
        }

        // Envio do formulário
        document.getElementById('cpfForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const cpfInput = document.getElementById('cpf');
            const btnBuscar = document.getElementById('btnBuscar');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            const cpf = cpfInput.value.replace(/[^\d]/g, '');
            
            // Limpa mensagens anteriores
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Validação
            if (!validarCPF(cpf)) {
                errorMessage.textContent = 'Por favor, informe um CPF válido.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Loading state
            btnBuscar.classList.add('loading');
            btnBuscar.disabled = true;
            
            try {
                // Obtém o store_id do meta tag (sem conversões)
                const storeId = document.querySelector('meta[name="store-id"]').getAttribute('content');
                
                const response = await fetch('/customer-services/api/buscar-pedidos.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        cpf: cpf,
                        store_id: storeId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // A resposta vem em data.data, não em data.pedidos
                    const pedidos = data.data && data.data.pedidos ? data.data.pedidos : [];
                    
                    if (pedidos && pedidos.length > 0) {
                        // Armazena os dados na sessão e redireciona
                        sessionStorage.setItem('pedidos_data', JSON.stringify(data));
                        window.location.href = 'escolher-acesso';
                    } else {
                        errorMessage.textContent = 'Nenhum pedido encontrado para este CPF.';
                        errorMessage.style.display = 'block';
                    }
                } else {
                    errorMessage.textContent = data.message || 'Erro ao buscar pedidos. Tente novamente.';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                console.error('Erro:', error);
                errorMessage.textContent = 'Erro de conexão. Tente novamente.';
                errorMessage.style.display = 'block';
            } finally {
                btnBuscar.classList.remove('loading');
                btnBuscar.disabled = false;
            }
        });
    </script>

<!-- Menu flutuante -->
<div class="menu-flutuante-container">
    <button id="btn-menu-flutuante" class="btn-menu-flutuante" title="Menu">
        <i class="fas fa-bars"></i>
    </button>
    <div class="menu-flutuante-opcoes">
        <a href="#" class="menu-opcao carrinho" id="btn-flutuante-carrinho" title="Carrinho">
            <span>Carrinho</span>
            <i class="fas fa-shopping-cart"></i>
        </a>
        <a href="../ajuda/index" class="menu-opcao ajuda" title="Ajuda">
            <span>Ajuda</span>
            <i class="fas fa-headset"></i>
        </a>
        <a href="../faq/index" class="menu-opcao faq" title="FAQ">
            <span>FAQ</span>
            <i class="fas fa-question-circle"></i>
        </a>
        <a href="../index" class="menu-opcao pedidos pedidos-destaque" title="Loja Rápida">
            <span>Loja Rápida</span>
            <i class="fas fa-store"></i>
        </a>
        <a href="https://wa.me/551142102216" target="_blank" class="menu-opcao whatsapp" title="WhatsApp">
            <span>WhatsApp</span>
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://businesseducation.com.br" target="_blank" class="menu-opcao business" title="Site Business">
            <span>Site Business</span>
            <img src="../images/favicon-business.png" class="favicon-icon" alt="Business">
        </a>
    </div>
</div>

<script>
// Inicialização imediata do menu flutuante
(function() {
    // Controle do menu flutuante
    const btnMenuFlutuante = document.getElementById('btn-menu-flutuante');
    
    if (btnMenuFlutuante) {
        btnMenuFlutuante.addEventListener('click', function() {
            const menuContainer = document.querySelector('.menu-flutuante-container');
            const menuIcon = this.querySelector('i');
            
            menuContainer.classList.toggle('menu-aberto');
            
            // Alterna entre ícones de menu e fechar
            if (menuContainer.classList.contains('menu-aberto')) {
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
            } else {
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        });
    }

    // Função para fechar o menu
    function fecharMenu() {
        const menuContainer = document.querySelector('.menu-flutuante-container');
        const menuIcon = document.querySelector('#btn-menu-flutuante i');
        
        if (menuContainer && menuContainer.classList.contains('menu-aberto')) {
            menuContainer.classList.remove('menu-aberto');
            if (menuIcon) {
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
            }
        }
    }

    // Função do botão de carrinho
    const btnFlutuanteCarrinho = document.getElementById('btn-flutuante-carrinho');
    if (btnFlutuanteCarrinho) {
        btnFlutuanteCarrinho.onclick = function(e) {
            e.preventDefault();
            // Redireciona para a página da loja
            window.location.href = '../index';
            
            // Fecha o menu após clicar
            fecharMenu();
        };
    }

    // Adiciona evento para fechar menu ao clicar em qualquer opção
    const menuOpcoes = document.querySelectorAll('.menu-opcao');
    if (menuOpcoes.length > 0) {
        menuOpcoes.forEach(opcao => {
            if (opcao.id !== 'btn-flutuante-carrinho') { // Já tratamos o carrinho separadamente
                opcao.addEventListener('click', function() {
                    fecharMenu();
                });
            }
        });
    }
    
    // Adiciona funcionalidade ao botão de carrinho no header
    const headerBtnCarrinho = document.getElementById('header-btn-carrinho');
    if (headerBtnCarrinho) {
        headerBtnCarrinho.onclick = function(e) {
            e.preventDefault();
            // Redireciona para a página da loja
            window.location.href = '../index';
        };
    }
})();
</script>
</body>
</html> 
